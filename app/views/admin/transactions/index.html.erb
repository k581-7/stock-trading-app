<div class="container-xl pt-4 pb-5 px-3 px-md-4 px-lg-5">
  <div class="d-flex align-items-center gap-2 mb-3">
    <i class="bi bi-activity text-primary"></i>
    <h4 class="fw-semibold mb-0">Transaction Monitor</h4>
    <div class="ms-auto">
      <%= link_to "#", class: "btn btn-primary d-inline-flex align-items-center gap-2" do %>
        <i class="bi bi-download"></i> Export
      <% end %>
    </div>
  </div>

  <!-- KPI cards unchanged ... -->

  <div class="card border-0 shadow-sm">
    <div class="card-body px-4">
      <h5 class="card-title mb-3">Transaction History (<%= @total_tx %> transactions)</h5>

      <div class="table-responsive">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th style="min-width:170px;">Date &amp; Time</th>
              <th>User</th>
              <th>Symbol</th>
              <th>Type</th>
              <th class="text-end">Quantity</th>
              <th class="text-end">Price</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            <% @transactions.each do |t| %>
              <% total = (t.quantity || 0) * (t.amount || 0) %>
              <tr>
                <td>
                  <div><%= t.created_at.strftime("%-m/%-d/%Y") %></div>
                  <small class="text-secondary"><%= t.created_at.strftime("%-I:%M:%S %p") %></small>
                </td>

                <td>
                  <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-secondary-subtle text-secondary d-flex align-items-center justify-content-center me-2" style="width:28px;height:28px;">
                      <i class="bi bi-person"></i>
                    </div>
                    <div>
                      <div>
                        <%= ([(t.user&.first_name), (t.user&.last_name)].map(&:presence).compact.join(" ").presence ||
                             t.user&.username.presence ||
                             "User") %>
                      </div>
                      <small class="text-secondary">ID: <%= t.user_id %></small>
                    </div>
                  </div>
                </td>

                <td class="fw-semibold"><%= t.stock&.symbol || "â€”" %></td>
                <td>
                  <% if t.transaction_type == "buy" %>
                    <span class="badge rounded-pill bg-success-subtle text-success d-inline-flex align-items-center gap-1">
                      <i class="bi bi-graph-up-arrow"></i> BUY
                    </span>
                  <% else %>
                    <span class="badge rounded-pill bg-danger-subtle text-danger d-inline-flex align-items-center gap-1">
                      <i class="bi bi-graph-down-arrow"></i> SELL
                    </span>
                  <% end %>
                </td>
                <td class="text-end"><%= t.quantity %></td>
                <td class="text-end"><%= number_to_currency(t.amount) %></td>
                <td class="text-end fw-semibold"><%= number_to_currency(total) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<style>
  .bg-success-subtle{ background:#e9f7ef!important; color:#198754!important; }
  .bg-danger-subtle { background:#fde2e1!important; color:#dc3545!important; }
  .bg-secondary-subtle{ background:#f1f3f5!important; color:#6c757d!important; }
  .bg-primary-subtle{ background:#e7f1ff!important; color:#0d6efd!important; }
</style>

<div class="d-flex align-items-center gap-2 mb-3">
  <i class="bi bi-activity text-primary"></i>
  <h4 class="fw-semibold mb-0">Transaction Monitor</h4>
</div>

<!-- KPI Cards -->
<div class="row g-3 mb-4">
  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Total Transactions</div>
          <div class="h4 mb-0 fw-bold"><%= @total_tx %></div>
        </div>
        <div class="rounded-3 bg-primary-subtle text-primary p-3">
          <i class="bi bi-activity fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Total Volume</div>
          <div class="h4 mb-0 fw-bold text-success"><%= number_to_currency(@total_volume) %></div>
        </div>
        <div class="rounded-3 bg-success-subtle text-success p-3">
          <i class="bi bi-currency-dollar fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Buy Orders</div>
          <div class="h4 mb-0 fw-bold"><%= @buy_count %></div>
        </div>
        <div class="rounded-3 bg-success-subtle text-success p-3">
          <i class="bi bi-graph-up-arrow fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Sell Orders</div>
          <div class="h4 mb-0 fw-bold"><%= @sell_count %></div>
        </div>
        <div class="rounded-3 bg-danger-subtle text-danger p-3">
          <i class="bi bi-graph-down-arrow fs-4"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Transaction History -->
<div class="card border-0 shadow-sm">
  <div class="card-body">
    <h5 class="card-title mb-3">Transaction History (<%= @total_tx %> transactions)</h5>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th style="min-width: 170px;">Date &amp; Time</th>
            <th>User</th>
            <th>Symbol</th>
            <th>Type</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Price</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          <% @transactions.each do |t| %>
            <% total = (t.quantity || 0) * (t.amount || 0) %>
            <tr>
              <!-- Date & Time -->
              <td>
                <div><%= t.created_at.strftime("%-m/%-d/%Y") %></div>
                <small class="text-secondary"><%= t.created_at.strftime("%-I:%M:%S %p") %></small>
              </td>

              <!-- User cell -->
              <td>
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-secondary-subtle text-secondary d-flex align-items-center justify-content-center me-2" style="width:28px;height:28px;">
                    <i class="bi bi-person"></i>
                  </div>
                  <div>
                    <div><%= t.user&.username.presence || "User" %></div>
                    <small class="text-secondary">ID: <%= t.user_id %></small>
                  </div>
                </div>
              </td>

              <!-- Symbol -->
              <td class="fw-semibold"><%= t.stock&.symbol || "â€”" %></td>

              <!-- Type -->
              <td>
                <% if t.transaction_type == "buy" %>
                  <span class="badge rounded-pill bg-success-subtle text-success d-inline-flex align-items-center gap-1">
                    <i class="bi bi-graph-up-arrow"></i> BUY
                  </span>
                <% else %>
                  <span class="badge rounded-pill bg-danger-subtle text-danger d-inline-flex align-items-center gap-1">
                    <i class="bi bi-graph-down-arrow"></i> SELL
                  </span>
                <% end %>
              </td>

              <!-- Numbers -->
              <td class="text-end"><%= t.quantity %></td>
              <td class="text-end"><%= number_to_currency(t.amount) %></td>
              <td class="text-end fw-semibold"><%= number_to_currency(total) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
  .bg-primary-subtle  { background:#e7f1ff!important; color:#0d6efd!important; }
  .bg-success-subtle  { background:#e9f7ef!important; color:#198754!important; }
  .bg-danger-subtle   { background:#fde2e1!important; color:#dc3545!important; }
  .bg-secondary-subtle{ background:#f1f3f5!important; color:#6c757d!important; }
</style>

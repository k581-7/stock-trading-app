<%# app/views/admin/dashboard/index.html.erb %>

<!-- KPI Cards -->
<div class="row g-3 mb-4">
  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Total Users</div>
          <div class="h4 mb-0 fw-bold"><%= @allusers.where(role: [ "trader", "broker" ]).count %></div>
        </div>
        <div class="rounded-3 bg-primary-subtle text-primary p-3">
          <i class="bi bi-people-fill fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Pending Traders</div>
          <div class="h4 mb-0 fw-bold"><%= @users.count %></div>
        </div>
        <div class="rounded-3 bg-warning-subtle text-warning p-3">
          <i class="bi bi-clock-history fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Pending Brokers</div>
          <div class="h4 mb-0 fw-bold"><%= @pending_brokers.count %></div>
        </div>
        <div class="rounded-3 bg-warning-subtle text-warning p-3">
          <i class="bi bi-person-x-fill fs-4"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Approved Brokers</div>
          <div class="h4 mb-0 fw-bold"><%= @approved_brokers.count %></div>
        </div>
        <div class="rounded-3 bg-success-subtle text-success p-3">
          <i class="bi bi-person-check-fill fs-4"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="card border-0 shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Quick Actions</h5>
    <div class="d-flex flex-wrap gap-3">
      <%= link_to new_admin_user_path, class: "btn btn-primary-subtle border-0 btn-lg d-flex align-items-center gap-2" do %>
        <i class="bi bi-plus-lg"></i> Add New User
      <% end %>

      <%= link_to pending_approvals_admin_users_path, class: "btn btn-warning-subtle border-0 btn-lg d-flex align-items-center gap-2" do %>
        <i class="bi bi-clock-history"></i> Review Pending
      <% end %>

      <%= link_to all_users_admin_users_path, class: "btn btn-success-subtle border-0 btn-lg d-flex align-items-center gap-2" do %>
        <i class="bi bi-people"></i> View All Users
      <% end %>

      <%= link_to admin_users_path, class: "btn btn-purple-subtle border-0 btn-lg d-flex align-items-center gap-2" do %>
        <i class="bi bi-activity"></i> View Transactions
      <% end %>
    </div>
  </div>
</div>

<!-- Recent Activity -->
<div class="card border-0 shadow-sm">
  <div class="card-body">
    <h5 class="card-title mb-3">Recent Activity</h5>

    <% if @recent_activities.present? %>
      <div class="list-group list-group-flush">
        <% @recent_activities.each do |a| %>
          <div class="list-group-item d-flex align-items-center py-3">
            <%# colored dot by type %>
            <% dot_class =
                case a[:type]
                when :new_user then 'bg-success'
                when :approved then 'bg-primary'
                when :application then 'bg-warning'
                else 'bg-secondary'
                end %>
            <span class="rounded-circle me-3 d-inline-block <%= dot_class %>" style="width:10px;height:10px;"></span>

            <div class="flex-grow-1">
              <div><%= a[:message] %></div>
            </div>
            <small class="text-secondary ms-3"><%= time_ago_in_words(a[:created_at]) %> ago</small>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-secondary">No recent activity.</div>
    <% end %>
  </div>
</div>

<!-- Subtle button styles -->
<style>
  .btn-primary-subtle    { background: #e7f1ff; color:#0d6efd; }
  .btn-warning-subtle    { background: #fff3cd; color:#b58100; }
  .btn-success-subtle    { background: #e9f7ef; color:#198754; }
  .btn-purple-subtle     { background: #f3e8ff; color:#6f42c1; }
</style>

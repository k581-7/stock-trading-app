<div class="container mt-4">
<!-- ðŸ§¾ Wallet Header -->
<div class="mb-4">
  <h2 class="fw-bold">Wallet</h2>
  <p class="text-muted">Approved Trader</p>
</div>

<!-- ðŸ’³ Summary Metrics -->
<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="card text-center border-success shadow-sm">
      <div class="card-body">
        <h6 class="text-muted">Available Balance</h6>
        <h4 class="text-success fw-bold"><%= number_to_currency(@wallet.balance) %></h4>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-center border-primary shadow-sm">
      <div class="card-body">
        <h6 class="text-muted">Total Deposits</h6>
        <h4 class="text-primary fw-bold"><%= number_to_currency(@wallet.total_deposits) %></h4>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-center border-info shadow-sm">
      <div class="card-body">
        <h6 class="text-muted">Trading Volume</h6>
        <h4 class="text-info fw-bold"><%= number_to_currency(@wallet.trading_volume) %></h4>
      </div>
    </div>
  </div>
</div>

<!-- âž• Top Up & Withdraw -->
<div class="row g-4 mb-4">
  <div class="col-md-6">
    <div class="card border-success shadow-sm">
      <div class="card-header bg-success text-white">Top Up</div>
      <div class="card-body">
        <%= form_with url: top_up_wallet_path, method: :post, local: true do |f| %>
          <div class="mb-3">
            <%= label_tag :amount, "Amount" %>
            <%= number_field_tag :amount, nil, step: "0.01", min: "0.01", class: "form-control", required: true %>
          </div>
          <%= submit_tag "+ Top Up", class: "btn btn-success w-100" %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card border-danger shadow-sm">
      <div class="card-header bg-danger text-white">Withdraw</div>
      <div class="card-body">
        <%= form_with url: withdraw_wallet_path, method: :post, local: true do |f| %>
          <div class="mb-3">
            <%= f.label :amount, "Amount" %>
            <%= f.number_field :amount, step: 0.01, min: "0.01", class: "form-control", required: true %>
          </div>
          <%= f.submit "Withdraw", class: "btn btn-danger w-100" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- ðŸ“„ Transaction History -->
<div class="card shadow-sm">
  <div class="card-header bg-secondary text-white">
    <h6 class="mb-0">Transaction History</h6>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Description</th>
            <th class="text-end">Amount</th>
            <th class="text-end">Balance After</th>
          </tr>
        </thead>
        <tbody>
          <% @wallet_logs.each do |log| %>
            <tr>
              <td><%= log.created_at.strftime("%b %d, %Y %I:%M %p") %></td>
              <td><%= log.transaction_type.capitalize %></td>
              <td>
                <% if log.transaction_type.in?(%w[buy sell]) %>
                  <%= "#{log.transaction_type.capitalize} #{log.quantity} shares of #{log.stock&.symbol}" %>
                <% elsif log.transaction_type == "deposit" %>
                  Deposit via bank transfer
                <% elsif log.transaction_type == "withdraw" %>
                  Withdrawal to linked account
                <% else %>
                  â€”
                <% end %>
              </td>
              <td class="text-end <%= log.amount >= 0 ? 'text-success' : 'text-danger' %>">
                <%= number_to_currency(log.amount) %>
              </td>
              <td class="text-end"><%= number_to_currency(log.wallet&.balance || 0) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
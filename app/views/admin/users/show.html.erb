<%# ===== Back + Title ===== %>
<div class="d-flex align-items-center gap-2 mb-3">
  <%= link_to admin_users_path, class: "text-decoration-none d-flex align-items-center gap-2" do %>
    <i class="bi bi-arrow-left"></i>
    <span>Back to Users</span>
  <% end %>
</div>

<div class="d-flex align-items-center gap-3 mb-3">
  <div class="rounded-circle bg-primary-subtle text-primary d-flex align-items-center justify-content-center" style="width:40px;height:40px;">
    <i class="bi bi-person fs-5"></i>
  </div>
  <div>
    <h4 class="mb-0 fw-semibold">User Details</h4>
    <small class="text-secondary"><%= @user.username.presence || @user.email.split("@").first %></small>
  </div>
</div>

<%# ===== Profile Card ===== %>
<div class="card border-0 shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start">
      <div class="d-flex align-items-center">
        <div class="rounded-circle bg-primary-subtle text-primary d-flex align-items-center justify-content-center me-3" style="width:56px;height:56px;">
          <i class="bi bi-person fs-3"></i>
        </div>
        <div>
          <h5 class="mb-1 fw-semibold"><%= @user.username.presence || "—" %></h5>
          <div class="text-secondary"><%= @user.email %></div>
          <small class="text-secondary d-block">User ID: <%= @user.id %></small>
        </div>
      </div>

      <%# Status badge on the right %>
      <% status_label, status_classes =
          if @user.trader? && @user.broker_pending?
            ["Pending Approval", "badge rounded-pill bg-warning-subtle text-warning"] # broker upgrade
          elsif @user.trader? && !@user.approved?
            ["Pending Approval", "badge rounded-pill bg-warning-subtle text-warning"] # new trader
          elsif @user.broker? || @user.broker_approved? || @user.approved?
            ["Active", "badge rounded-pill bg-success-subtle text-success"]
          else
            ["—", "badge rounded-pill bg-secondary-subtle text-secondary"]
          end %>
      <span class="<%= status_classes %> d-inline-flex align-items-center gap-2 px-3 py-2">
        <i class="bi bi-clock"></i> <%= status_label %>
      </span>
    </div>

    <%# Info tiles row %>
    <div class="row g-3 mt-3">
      <div class="col-12 col-md-4">
        <div class="p-3 rounded-3 border bg-light-subtle">
          <div class="text-secondary small d-flex align-items-center gap-2">
            <i class="bi bi-calendar2"></i> <span>Approval Date</span>
          </div>
          <div class="mt-1">
            <%= @user.approval_date.present? ? @user.approval_date.strftime("%-m/%-d/%Y") : "—" %>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="p-3 rounded-3 border bg-light-subtle">
          <div class="text-secondary small d-flex align-items-center gap-2">
            <i class="bi bi-shield"></i> <span>Account Type</span>
          </div>
          <div class="mt-1">
            <%# Show 'Pending Trader' or 'Pending Broker'%>
            <%=
              if @user.trader? && !@user.approved? && !@user.broker_pending?
                "Pending Trader"
              elsif @user.trader? && @user.broker_pending?
                "Pending Broker"
              else
                @user.role.humanize
              end
            %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .bg-primary-subtle  { background:#e7f1ff!important; color:#0d6efd!important; }
  .bg-success-subtle  { background:#e9f7ef!important; color:#198754!important; }
  .bg-warning-subtle  { background:#fff3cd!important; color:#b58100!important; }
  .bg-secondary-subtle{ background:#f1f3f5!important; color:#6c757d!important; }
  .bg-light-subtle    { background:#f8f9fa!important; }
</style>
